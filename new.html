<!doctype html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no" />
<meta content="email=no" name="format-detection" />
<meta name="apple-touch-fullscreen" content="YES">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<style type="text/css">
html,body{margin:0;padding:0;width:100%;height:100%}
body{font:14px weiruanyahei,FZYQJW,"微软雅黑",Tahoma,"\534E\6587\5B8B\4F53",arial}
ul,ul li,ol,ol li,dl,dl dd,p{ list-style:none;margin:0;padding:0;}
h1,h2,h3,h4,h5,h6,strong{margin:0;padding:0;font-style:normal;}
.mapBox{width:100%;height:100%}
.mapInfo{position:absolute;width:100%;z-index:1;background:rgba(255,255,255,0.7)}

.menuBox{position:fixed;top:0;left:0;z-index:1}
.menuBox .list{display:none;position:absolute;width:60px;height:60px;background-repeat:no-repeat;background-size:100% 100%;background-position:center center}
.user_headimg{border-radius:50%;width:40px;height:40px;margin:4px 4px}
.map_userHeadBox{text-align:center;-webkit-transform: translate(-50%,-100%)}
.map_userHeadBox.self{}
.map_userHead{border:2px solid #fff;border-radius:50%;width:30px;height:30px;display:block;margin:0 auto;/*margin:-15px;-webkit-transition:left 10000ms linear,top 10000ms linear*/}
.map_hongbao{width:1px;height:1px}
.map_hongbaoImg{width:40px;-webkit-transition:all 300ms ease;-webkit-transform:translate(-50%,-50%) scale(.5); opacity:0/**/}
.timeBanner{border-radius:15px;height:20px;color:#e64b4b;width:128px;text-align:left;margin:0;background:#683400 url(img/daoju/bg.png) no-repeat;background-size:auto 100%;font-size: 10px;}
.timeBanner img{vertical-align: middle;margin:2px;height:16px}
.paopao{position:absolute;top:50%;left:50%;background:url(img/ico/poof.png) no-repeat left top;width:128px;height:128px;background-size:auto;z-index:1;top:30px;-webkit-transform:translate(-50%,-50%);}
</style>
</head><body>
<script src="//a-h5.mtq.tvm.cn/yao/common/jc/config_https.js"></script>
<script src="//qa-h5.mtq.tvm.cn/yao/common/jc/xdTools-1.0.js"></script>
<script src="https://e-cdn.yaotv.tvm.cn/cdn/etag/tvme-0.9.js"></script>
<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&key=IPVBZ-BO4HG-MD3QU-I75W4-F7KUZ-PSBYI"></script>
<div class="mapInfo"></div>   
<script type="text/javascript">
(function(){
var DO=document,DB=DO.body,winW=window.innerWidth,winH=window.innerHeight
,mainVar={temporary:{}}
,search
,refer_code
,ST_user=localStorage.getItem("userInfo")
,ST_runTime=localStorage.getItem("runTime")
,addata=localStorage.getItem("adobj")
,adObj=toObject(addata)||{data:[],time:0}
,ADDATA=adObj.data
,userInfo=toObject(ST_user)||{}
,people=[]
,showAddressFlag=true
,showAddressCount=0
,MAP
,QQMAP=qq.maps
,LatLng=QQMAP.LatLng
,CONFIG={
	sound:new Audio,
	hongbao:[{name:'北京市',gps:'39.90469,116.40717'},{name:'天津市',gps:'39.0851,117.19937'},{name:'河北省',gps:'38.03599,114.46979'},{name:'山西省',gps:'37.87343,112.56272'},{name:'内蒙古自治区',gps:'40.81733,111.76522'},{name:'辽宁省',gps:'41.83571,123.42925'},{name:'吉林省',gps:'43.89616,125.3268'},{name:'黑龙江省',gps:'45.74208,126.66285'},{name:'上海市',gps:'31.23037,121.4737'},{name:'江苏省',gps:'32.06071,118.76295'},{name:'浙江省',gps:'30.26555,120.1536'},{name:'安徽省',gps:'31.86157,117.28565'},{name:'福建省',gps:'26.09982,119.29659'},{name:'江西省',gps:'28.67417,115.91004'},{name:'山东省',gps:'36.66825,117.02058'},{name:'河南省',gps:'34.76571,113.75322'},{name:'湖北省',gps:'30.54539,114.34234'},{name:'湖南省',gps:'28.11266,112.9834'},{name:'广东省',gps:'23.13171,113.26627'},{name:'广西壮族自治区',gps:'22.81521,108.32754'},{name:'海南省',gps:'20.01997,110.34863'},{name:'重庆市',gps:'29.56471,106.55073'},{name:'四川省',gps:'30.65089,104.07572'},{name:'贵州省',gps:'26.5982,106.70722'},{name:'云南省',gps:'25.0453,102.70973'},{name:'西藏自治区',gps:'29.64725,91.11748'},{name:'陕西省',gps:'34.26486,108.95424'},{name:'甘肃省',gps:'36.05942,103.82634'},{name:'青海省',gps:'36.62087,101.78011'},{name:'宁夏回族自治区',gps:'38.47117,106.25867'},{name:'新疆维吾尔自治区',gps:'43.79343,87.6271'},{name:'台湾',gps:'25.024017,121.539688'},{name:'香港特别行政区',gps:'22.27534,114.16546'},{name:'澳门特别行政区',gps:'22.18684,113.54294'}
]		
	,mapBox:createNode(DB,"div",{className:"mapBox"})
	,mapType:{
			center:new LatLng(39.916527,116.397128),
			zoom:5,
			zoomControl:!1
		}
},PAGE={title:"摇一摇福利到",
	token:"46497107fa23"
	,yyyappid:"46497107fa23"
	,channelId:"wxd06496bae6bb4a78"
	}
function CustomOverlay($opt){
	this.position =$opt.pos;
	this.div=$opt.ele
}
CustomOverlay.prototype=new QQMAP.Overlay();
CustomOverlay.prototype.construct=function(){
	var panes = this.getPanes(),div=this.div,sty=div.style;
	sty.cursor = "pointer";
	sty.position="absolute"
	panes.overlayMouseTarget.appendChild(div);
}
CustomOverlay.prototype.draw=function($x,$y) {
	var t=this,overlayProjection=t.getProjection()
	,pos=overlayProjection.fromLatLngToDivPixel(t.position)
	,x=$x||0,y=$y||0
	,sty=t.div.style;
	sty.left=pos.x-x+"px";
	sty.top =pos.y-y+"px";
}
CustomOverlay.prototype.destroy=function(){
	this.div.onclick = null;
	this.div.parentNode.removeChild(this.div);
	this.div = null
}
if(userInfo.request==="XD"){
	init();
}else{
	search=getSearch2();
	var id=search.openid||userInfo.openid
	 if(id){
		getUserInfo(id,function($data){
			if($data.err===false){
				var msg=$data.msg
				if(msg.openid!=""){
					if(userInfo.openid){
						userInfo.source=msg.source
					}else{
						msg.sig=search.sig;
						userInfo=msg;
						userInfo.setTime=+new Date;
					}
					init()
					if(userInfo.source==1)
						userInfo.request="XD"
					else userInfo.request=1;
					localStorage.setItem("userInfo",JSON.stringify(userInfo));
				}else{
					tishi("返回用户身份错误",{time:3000,fun:function(){
						toSQ()
						}})
					}
			}else{
				tishi("获取用户身份失败",{time:3000,fun:function(){
						toSQ()
						}})
				}
			})		
	}else{
		toSQ();return
	}
}

function getAD(){
	if(!mainVar.tvme){
		mainVar.tvme=new tvmE()
		}
	var now=+new Date;
	if(now-adObj.time>3e5||ADDATA.length<2){
		ADDATA=[];
		getdata()
		}
	function getdata(){
		var tvme=mainVar.tvme,user=userInfo,data,card,locationObj=user.location||{};
		  tvme.getadbytag('','','',user.openid,user.nickname,user.sex,locationObj.region||"0",locationObj.gps||'0,0',function($data){
			  if($data.errcode==="0"){
				  data=$data.data;
				  if(data){
					  card=data.tagcards;
					  if(card.length>0){
							  //这里返回了卡券数据 
							 ADDATA=ADDATA.concat(card);
							 var len=ADDATA.length
							 if(len>10){
								 ADDATA.sort(function(a,b){
									 return a.red-b.red
									 })
									ADDATA=ADDATA.splice(0,10) 
								}else if(len<10){
									 console.log("再取卡券")
									 getdata()
									 }
							 var o={time:+new Date,data:ADDATA};
							 localStorage.setItem("adobj",JSON.stringify(o));
							 mainVar.theDoor&&mainVar.theDoor.cardType();
						  }else{
							tishi("卡券数据为空")  
							  }
					 }else{
						 tishi("没有数据返回")
					  }
				  }else{
					  tishi("没有广告数据"+$data.errcode)
					  }
			  },'channelmid%3d'+(user.channel||1782)+'%26did%3d'+(locationObj.adcode||0)+'%26tcat_title%3dfinance')		
		}	
	}
function createMain(){
	var box=createNode(DB,"div",{className:"menuBox",style:""})
	,t=this,ml=5,mt=5
	,menu={
		yyy:createNode(box,"div",{action:"menu.,yyy",className:"list",style:"left:"+ml+"px;top:"+mt+"px"})
		,msg:createNode(box,"div",{action:"menu.,msg",className:"list",style:"left:"+(winW-60)+"px;top:"+mt+"px"})
		,daoju:createNode(box,"div",{action:"menu.,daoju",className:"list",style:"left:"+ml+"px;top:"+(winH-150)+"px"})
		,home:createNode(box,"div",{action:"menu.,home",className:"list",style:"left:"+ml+"px;top:"+(winH-80)+"px;width:50px;height:66px",html:""})
		,handleEvent:function(e){
			docAction(e,{action:"action",fun:function($t,$action){
				var action=$action.split(".,")
				switch(action[0]){
					case "menu":
						menuAction(action[1]);
					break
					}
				}
			})
			noPop(e)			
			}
		}
	t.menu=menu;
	addEvent(box,'click',menu)	
	}	
function docAction(e,$opt){
	var ele=e.srcElement||e.target,opt=$opt||{},_action=opt.action||"action",attribute,argument,a1;				
			do{
				if(ele.nodeType!==1)break
				if(attribute=ele.getAttribute(_action))break			
				}while(ele=ele.parentNode)					
			if(attribute){							
				isFun(opt.fun,ele,attribute)
			}
	}
/*菜单动作中心*/	
function menuAction($item){
	switch($item){
		case"yyy"://摇一摇
		tishi("去摇一摇")
		break
		case"msg": //消息
			mainVar.dialog.news();		
		break
		case"daoju"://道具
			mainVar.dialog.store();
		break
		case"home"://个人中心
			mainVar.dialog.topUp({'source':'prop'});
			mainVar.temporary.entrance=true;
		break
		}
	}
function getMoney(){
var a=setAjax('GET',HOST.BALANCE+'/open/user/virtualcurrency?channelid='+PAGE.channelId+SU()+'&code='+userInfo.sig+'&cache='+Math.random())
	,b=setAjax("GET",HOST.DOMAIN2+"/open/account/balance?openid="+userInfo.openid+"&sig="+userInfo.sig)
	,c=setAjax("GET",HOST.GOLDCOIN+"/point/integral/query?wxToken=wxd06496bae6bb4a78&openId="+userInfo.openid+"&ca="+Math.random())
	a.callBack=function($data){
		var data=toObject($data),body,v=0;
			if(data.status=="success"){
				if(body=data.body){
					v=body.virtualCurrency;
				}
			};
				userInfo.money=v;
				crateBottom("m2",(v/100)+"元");
				a=null
	}
	b.callBack=function($data){
		var data=toObject($data),v;
		if(data.status==="success"){
			v=data.data
			userInfo.tixian=v;
			crateBottom("m3",(v/100)+"元")
			}b=null
		}
	c.callBack=function($data){
		var data=toObject($data),jinbi;
		if(data=data.data){
			jinbi=data.integral
			userInfo.jinbi=jinbi;
			crateBottom("m1",jinbi+"个")
			}c=null
	}	
	a.send()	
	b.send()
	c.send()
}
function createUser($opt){
	var overlay=new CustomOverlay({pos:$opt.latlng,ele:$opt.ele});
		overlay.setMap(MAP);	
		return overlay
	}
//生成用户头像
function setPP(){
	var time=setInterval(show,1000),a=setAjax('get',HOST.BALANCE+'/open/welfare/list?yyyappid='+PAGE.yyyappid),temp={};
		a.callBack=function($data){
			var data=toObject($data)
			console.log(data.status)
			if(data.status==="success"){
				people=people.concat(data.winList)
				}
			console.log(people)
			}
        a.send();
	function show(){
		var p=people.shift(),u,gps,ln,img
		if(p){
			u=p.userInfo
			gps=u.gps
			img=u.icon
			if(gps&&img!==""){
				ln=gps.split(",");
				cName="map_userHeadBox"+(u.identity==="self"?" self":"")
				u.ele=createNode(DB,"div",{className:cName})
				u.latlng=new LatLng(ln[1],ln[0])
				u.pos=createUser(u)
				showAddress(u.ele)	
			}
		}else{
			clearInterval(time)
		}
		function showAddress(target){
		    var name=u.name
		    	,headimg=img===""?"http://a-h5.mtq.tvm.cn/yao/common/img/user.gif":img.replace(/0$/,'96')
		        ,address=u.area?u.area.split('-'):[]
		        ,userAddress=(address[3]?(address[2]+address[3]):(address[2]?address[2]:'北京市.'))
		        ,number=1
		        ,width=(winW>420?414:winW)
		        ,headW=0.11*width
		        ,headH=0.15*width
		        ,headImgW=0.07*width
		        ,infoW=0.49*width
		        ,html='<div class="head clearfix"><div class="userHead">\
		                    <img src="'+headimg+'"/></div></div>\
		                <div class="infoList">\
		                <p><span class="name">'+rp(name)+'</span><span class="address">'+userAddress+'</span></p>\
		                <p><span class="desc">刚刚抢到'+number+'个现金红包</span></p>\
		                </div>'
		        ,info
		        ,head
		        ,infoList
		        ;
		        if(temp[address[1]]==1)return;
		        temp[address[1]]=1;
		        info=createNode(target,'div',{className:'addInfo',html:html},'p2')
		        head=info.querySelector('.head')
		        infoList=info.querySelector('.infoList')
		        if(showAddressFlag){
		            setStyle(".addInfo{position:relative;z-index: 9999;}"
		            +".addInfo .head{width: "+headW+"px;height: "+headH+"px;background-image:url(./img/zb.png);background-repeat: no-repeat;background-size:100% 100%;position:absolute;z-index: 9999;top:-"+headH+"px;left:-"+headW*0.5+"px;-webkit-transform-origin:bottom;-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}"
		            +".addInfo .head .userHead{width: "+headImgW+"px;height: "+headImgW+"px;border: "+0.008*width+"px solid #fff;border-radius: 50%;overflow: hidden;margin:5px auto;}"
		            +".addInfo .head .userHead img{width: "+headImgW+"px;height: "+headImgW+"px;display:block;font-size:0;}"
		            +".addInfo .infoList{width: "+infoW+"px;overflow:hidden;font-size:12px;background-color: rgba(0,0,0,.6);border-radius: 5px; position:absolute;top:-"+headH*0.85+"px;left:0px;padding:5px 1px 5px "+headW*0.6+"px;box-sizing: border-box;-webkit-box-sizing:border-box;display:none; -webkit-transform-origin:left;-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}"
		            +".addInfo .infoList p{line-height: 15px;color:#fff;text-align: left;padding-right:5px;}"
		            +".addInfo .infoList p:nth-child(1){display:flex;display:-webkit-flex;}"
		            +".addInfo .infoList p span{white-space: nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom: 1px;}"
		            +".addInfo .infoList p .name{flex:1;-webkit-flex:1;text-align: left;}"
		            +".addInfo .infoList p .address{float:right;max-width: 50%;text-align: left;}"
		            +".addInfo .infoList p .desc{color:#f5ff43;}"
		            +".clearfix::after,.clearfix::before{content:'.';line-height: 0;height: 0;display: block;visibility: hidden;clear: both;}"
		            +"@keyframes ani{0%{-webkit-transform:scale3d(0,0,0);transform:scale3d(0,0,0);}100%{-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}}"
		            +"@-webkit-keyframes ani{0%{-webkit-transform:scale3d(0,0,0);transform:scale3d(0,0,0);}100%{-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}}"
		            +"@keyframes aniLeft{0%{display:block;width:0;-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}100%{width:"+infoW+"px;-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}}"
		            +"@-webkit-keyframes aniLeft{0%{display:block;width:0;-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}100%{width:"+infoW+"px;-webkit-transform:scale3d(0.8,0.8,1);transform:scale3d(0.8,0.8,1);}}"
		            )
		            showAddressFlag=false;
		        }
		        head.style.webkitAnimation='ani 300ms ease-in';
		        setTimeout(function(){infoList.style.display="block";infoList.style.webkitAnimation='aniLeft 150ms ease-in';},300)
		        showAddressCount++;
		        if(showAddressCount>5){
		        	removeNode(document.querySelector(".addInfo"))
		        	temp[address[1]]=0;
		        }
		}
	}
	}
function rp($s){
    return $s.replace(/[",',<,>,;,\,,{,},\.,\\,\/]/g,"")
}
//生成红包		
function setHB(){
	for(var i=0,hongbao=CONFIG.hongbao,nd=[],h;i<10;i++){
		h=hongbao.splice(Math.floor(Math.random()*hongbao.length),1)[0];
        nd.push(h)
		ln=h.gps.split(",");
		h.ele=createNode(DB,"div",{html:"",className:"map_hongbao"});
		h.img=createNode(h.ele,"img",{src:"img/ico/hongbao.png",className:'map_hongbaoImg'});	
		h.latlng=new LatLng(ln[0],ln[1]);
		h.pos=createUser(h)
		};
		hongbao=null;
	(function(){		
		var i=0,il=nd.length,style="background-image:url(img/ico/paopao.png);width:300px;height:300px;top:0;-webkit-transform:translate(-50%,-60%) scale(.5)"
		,time=setInterval(function(){
			if(i<il){
				var h=nd[i],sty=h.img.style;
				paopao({ele:h.ele,css:style,fl:13,space:300,runFun:function(i){
					if(i===8){
					sty.opacity=1;
					sty.webkitTransform="translate(-50%,-100%) scale(1)"
				}}})
				addEvent(h.img,"click",function(){
					console.log("点击红包",this)
				})
				i++
			}else{
				clearInterval(time)
			}
		},10)
	}());	
	}
mainVar.loadObj=xdLoadFun()			
function init(){
	MAP=new QQMAP.Map(CONFIG.mapBox,CONFIG.mapType);
	getAD();
	setHB();
	setPP();
	getMoney()
	//CONFIG.sound.src="media/message.mp3";
	//createMain.apply(CONFIG)	
	}
//工具类方法
function SU(){
	return '&yyyappId='+PAGE.yyyappid+'&openId='+userInfo.openid+'&sign='+userInfo.sig+'&sigExpire='+userInfo.sigExpire
	}
function toSQ($url){
	var url=$url||location.href;
		location.replace(HOST.AD+"/oauth?wx_token="+PAGE.token+"&redirecturl="+encodeURIComponent(url))
	};
function getUserInfo($id,$fun){
	window.getUserData=$fun;
	setJsonp(HOST.AD+'/ufo/puserinfo?wx_token='+PAGE.token+"&openid="+$id+"&cb=getUserData")
	}

function xdLoadFun(){
	if(!window.xdLoadEle){
		setStyle(".xdLoadBox{position:fixed;width:60px;height:60px;border-radius:5px;background:rgba(0,0,0,.5) url(img/loading.gif) no-repeat center center;display:none;top:50%;left:50%;background-size:30px 30px;-webkit-transform:translate(-50%,-50%);z-index:1000}")
		window.xdLoadEle=createNode(document.body,"div",{className:"xdLoadBox"})
		}
		return {show:function($opt){
			if($opt){
				if($opt.style)
				xdLoadEle.style.cssText=$opt.style
				}
			xdLoadEle.style.display="block";
		},hidd:function(){
			xdLoadEle.style.display="none"
			}
		}
	}
//边看边聊导航栏跳转链接
function goUrl($){var h,user=userInfo;
	switch($){
		case"M_SC_NEW":
			h="http://yaomall.tvm.cn/html/?q=deal/46497107fa23/0/buy-balance"
		break
		case "M_YL":
			h=" http://games.yaotv.tvm.cn/?f=wx&addi="+JSON.stringify({"yaotv_openid":user.openid,"yyyappid":PAGE.yyyappid,"sign":user.sig})+"&cache="+Math.random()
		break
		case "M_GRZX":
			h="http://a.h5.mtq.tvm.cn/yao_zhoubian/ttdsb/index.html?url=home.html"
		break
		case "M_HBBD":
			  h="share.html?type=money"
		break
		case "M_DJBD":
			h="share.html?type=dajiangsk"
		break
		case "FX":
			h="http://pmall.yaotv.tvm.cn/auth/fanxian?page=pickup&fromgzh=1"
		break
	}
	setTimeout(function(){
		if(h)location.href=h
		},200);
}	
function crateBottom($m,$v){
		if(!mainVar.menuBottom){
			var ele=createNode(DB,"div",{className:"menuBottom"})
				ele.m1=createNode(ele,"div",{className:"m1",title:"M_YL"})
				ele.m2=createNode(ele,"div",{className:"m2",title:"M_SC_NEW"})
				ele.m3=createNode(ele,"div",{className:"m3",title:"FX"})
				addEvent(ele,"click",function(e){
					var ele=e.srcElement,ac=ele.title
					goUrl(ac)
					})
			mainVar.menuBottom=ele
		}
		mainVar.menuBottom[$m].innerHTML=$v
	}
function setMoney(){
	userInfo.money-=CONFIG.spendMoney
	crateBottom("m2",userInfo.money/100+"元")
	//moneyBox.innerHTML="您的余额  <b>"+(userInfo.money/100) 
	//+"元</b><p onclick=\"location.href='http://yaomall.tvm.cn/html/?q=deal/46497107fa23/0/buy-balance'\">余额交易</p>"
	}	
function paopao($opt){
	var ele=createNode($opt.ele,"div",{className:"paopao",style:$opt.css}),i=0,il=$opt.fl,space=$opt.space,sty=ele.style
	,time=setInterval(function(){
		if(i<il){
			sty.backgroundPosition=-(i*space)+"px top";
			isFun($opt.runFun,i);
			i++;
		}else{
			clearInterval(time)
			isFun($opt.overFun)
			removeNode(ele)
			}
		},120)
	}		
function getHead($url){
	var url=decodeURIComponent($url)
	if(/\.jpg$|\.png$|\.gif$/gi.test(url))return url
	else{			
		return url.indexOf("tvm")>-1?url:url.replace("http://wx.qlogo.cn/mmopen/http://wx.qlogo.cn/mmopen/","http://wx.qlogo.cn/mmopen/")+"/64"
	}
}

 }())
</script>
</body></html>